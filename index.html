<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>DilekÃ§e OluÅŸtur</title>
  <style>
    body {
      font-family: Calibri, "Times New Roman", serif;
      background-color: #f4f4f4;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 30px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 6px;
      margin-bottom: 16px;
      font-size: 16px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
      margin-right: 10px;
      cursor: pointer;
    }
    
    .letter-section {
      display: none;
      margin-top: 40px;
      padding: 40px;
      background: white;
      border: none;
    }
    .center-text {
      text-align: center;
      margin: 0;
      line-height: 1.1;
    }
    .left-text {
      text-align: justify;
      margin-top: 20px;
      white-space: pre-line;
    }
    .download-button {
      display: none;
      margin-top: 20px;
    }
    .ders-item {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 20px;
      background-color: #fafafa;
    }
    @media print {
      body * {
        visibility: hidden;
      }
      .letter-section, .letter-section * {
        visibility: visible;
      }
      .letter-section {
        position: absolute;
        top: 0;
        left: 0;
        width: 210mm;
        height: 297mm;
        background: white !important;
        padding: 40px;
        margin: 0;
        box-shadow: none !important;
        border: none !important;
      }
      .download-button {
        display: none !important;
      }
    }
    .logo-image {
      display: block;
max-width: 80px;
      height: auto;
      margin-left: 0;
      margin-right: auto;
      margin-bottom: 20px;
      
    }

.tarih-sag {
  text-align: right;
  margin: 0;
  font-size: 16px;
}
#tarihYeri,
#imzaAlani {
  display: none;
}

.alt-kisim {
  display: flex;
  justify-content: space-between;
  gap: 20px; /* Ä°ki kolon arasÄ± boÅŸluk */
  margin-top: 30px;
}

.sol-metni {
  flex: 1;
  max-width: 50%;
  font-size: 16px;
  line-height: 1.4;
}

.sag-tablo {
  flex: 1;
  max-width: 50%;
}

.sag-tablo table {
  width: 100%; /* tabloyu kapsayÄ±cÄ±ya yay */
  border-collapse: collapse;
}

.sag-tablo td {
  border: 1px solid black;
  padding: 10px;
  height: 100px;
  /* width kaldÄ±rÄ±ldÄ±, Ã§Ã¼nkÃ¼ flex dÃ¼zenlemesi var */
}

.logo-header-container {
  display: flex;
  flex-direction: column;
  align-items: center; /* Yatayda ortalar */
  justify-content: center; /* Dikeyde ortalar */
  gap: 4px; /* Elemanlar arasÄ± boÅŸluk */
  margin-bottom: 20px; /* Alt boÅŸluk */
}

.logo-image {
  max-width: 80px;
  height: auto;
  margin-bottom: 8px; /* Logoyla baÅŸlÄ±klar arasÄ± boÅŸluk */
}

/* BaÅŸlÄ±klara kÃ¼Ã§Ã¼k boÅŸluklar ve hizalama */
.logo-title {
  margin: 0;
  line-height: 1.2;
}

.logo-subtitle {
  margin: 0;
  margin-bottom: 1cm;
  font-style: italic;
}

.alt-kisim {
  display: flex;
  margin-top: 30px;
  position: relative;
}

/* Sol kÄ±sÄ±m: geniÅŸlik minimum 2 cm + logo geniÅŸliÄŸi kadar ve soldan 2cm iÃ§eride */
.sol-metni {
  flex: 0 0 auto; /* geniÅŸliÄŸi iÃ§eriÄŸe gÃ¶re */
  padding-left: 0cm; /* soldan boÅŸluk */
}

/* Logo'yu solun tam 1cm iÃ§inden baÅŸlatmak iÃ§in */
.sol-metni img.logo-image {
  margin-left: 0cm;
}

/* SaÄŸ kÄ±sÄ±m: A4 geniÅŸliÄŸine gÃ¶re ortalanmÄ±ÅŸ */
.sag-tablo {
  flex: 1 1 auto;
  /* Sayfa geniÅŸliÄŸi A4: 210mm = 21cm, bizim container max-width zaten 900px â‰ˆ 21 cm */
  /* SaÄŸ kÄ±sÄ±m tam geniÅŸlikte deÄŸil ama biz iÃ§eriÄŸi ortalayacaÄŸÄ±z */
  display: flex;
  flex-direction: column;
  align-items: left; /* yatay ortala */
  justify-content: flex-start;
  padding-right: 6cm; /* saÄŸdan da boÅŸluk eklemek istersen */
}

/* Ä°Ã§ metinlerin ortalanmasÄ± */
.sag-tablo p {
  margin: 1px 0;
  font-weight: bold;
  text-align: center;
}

 table {
      border-collapse: collapse;
      width: 100%;
    }

    th, td {
      border: 1px solid black;
      padding: 8px;
      text-align: center;
    }


  </style>
</head>
<body>
  <div class="container">
    <h2>Mazeretli Ekle-Sil DilekÃ§esi OluÅŸturma</h2>
    <form id="dilekceForm">
      <label>AdÄ±nÄ±z:</label>
            <input type="text" id="ad" required />
      <label>SoyadÄ±nÄ±z:</label>
            <input type="text" id="soyad" required />
      <label>Ã–ÄŸrenci NumarasÄ±:</label>
            <input type="text" id="numara" required />
      <label>YÄ±ldÄ±z E-posta:</label>
            <div style="display: flex; align-items: center;">
            <input type="text" id="emailUser" required style="flex: 1;" placeholder="kullaniciadi" />
            <span style="margin-left: 5px;">@std.yildiz.edu.tr</span>
            </div>
      <label>Cep Telefonu:</label>
            <input type="text" id="telefon" required />
      <label>Mazeretiniz:</label>
            <textarea id="mazeret" rows="3" required></textarea>

<label>Eklenecek Ders <strong>Dahil</strong> GÃœZ YarÄ±yÄ±lÄ±nda <strong>AlÄ±nan Toplam Kredi</strong>:</label>
      <input type="number" id="krediT" required />

      <label>BÃ¶lÃ¼mÃ¼nÃ¼zÃ¼ SeÃ§iniz:</label>
            <select id="bolumSelect" required>
               <option value="MATEMATÄ°K BÃ–LÃœM BAÅKANLIÄINA">MATEMATÄ°K</option>
               <option value="FÄ°ZÄ°K BÃ–LÃœM BAÅKANLIÄINA">FÄ°ZÄ°K</option>
               <option value="KÄ°MYA BÃ–LÃœM BAÅKANLIÄINA">KÄ°MYA</option>
               <option value="Ä°STATÄ°STÄ°K BÃ–LÃœM BAÅKANLIÄINA">Ä°STATÄ°STÄ°K</option>
               <option value="MOLEKÃœLER BÄ°YOLOJÄ° VE GENETÄ°K BÃ–LÃœM BAÅKANLIÄINA">MOLEKÃœLER BÄ°YOLOJÄ° VE GENETÄ°K</option>
               <option value="TÃœRK DÄ°LÄ° VE EDEBÄ°YATI BÃ–LÃœM BAÅKANLIÄINA">TÃœRK DÄ°LÄ° VE EDEBÄ°YATI</option>
               <option value="BATI DÄ°LLERÄ° VE EDEBÄ°YATLARI BÃ–LÃœM BAÅKANLIÄINA">BATI DÄ°LLERÄ° VE EDEBÄ°YATLARI</option>
            </select>
    

      <div id="dersListesi"></div>
            <button type="button" onclick="dersEkle()">â• Ders Ekle</button>
      <br><br>
      <button type="submit">DilekÃ§eyi OluÅŸtur</button>
      </form>

      <div class="letter-section" id="dilekceOutput">

 <div class="alt-kisim">
  <div class="sol-metni">
    <p><img src="https://ytumat.github.io/mazeret_sinav_talebi_dilekcesi/logo.png" alt="Ãœniversite Logosu" class="logo-image" crossorigin="anonymous" />
</p>
  </div>
  <div class="sag-tablo">
   <br>
 <p class="center-text logo-title" style="font-weight: bold; text-align:center">YILDIZ TEKNÄ°K ÃœNÄ°VERSÄ°TESÄ°</p>
 <p class="center-text logo-title" style="font-weight: bold;">FEN-EDEBÄ°YAT FAKÃœLTESÄ°</p>
  <p id="bolumYazisi" class="center-text logo-title" style="font-weight: bold;"></p>
 <p class="center-text logo-title" style="font-weight: bold;">MAZERETLÄ° DERS EKLE-SÄ°L DÄ°LEKÃ‡ESÄ°</p>
  </div>
</div>

    
<div style="display: flex; justify-content: space-between; margin-top: 40px;">
  <p id="adSoyadYazisi" style="margin: 0;"><strong>AdÄ±-SoyadÄ±:</strong> </p>
  <p id="ustTarihYazisi" style="margin: 0;">Tarih: </p>
</div>

<!-- Alt satÄ±rdan devam eden sola yaslÄ± bilgiler -->
    <div style="margin-top: 0;">
         <p id="numaraYazisi" style="margin: 0;"></p>
         <p id="telefonYazisi" style="margin: 0;"></p>
         <p id="emailYazisi" style="margin:  0 0 0;"></p>
    </div>
<br><br>


<p style="text-align: justify;">
  <strong>2025-2026</strong> eÄŸitim-Ã¶ÄŸretim yÄ±lÄ± <strong>GÃœZ</strong> YarÄ±yÄ±lÄ± ders kayÄ±t haftasÄ±nda aÅŸaÄŸÄ±da belirtmiÅŸ olduÄŸum mazeretten Ã¶tÃ¼rÃ¼ ders kaydÄ±mÄ±/ekle-sil iÅŸlemini yapamadÄ±m. Eklemek/silmek istediÄŸim aÅŸaÄŸÄ±da yazÄ±lÄ± derslerin Ã¶ÄŸrenci otomasyon sistemine iÅŸlenmesi iÃ§in gereÄŸini arz ederim.
</p>


<table id="gerekceTablosu" style="margin-top: 30px; width: 100%; border-collapse: collapse; border: none;">
  <thead>
    <tr>
      <th style="text-align: justify; border: none; padding: 0px; min-height: 150px;">
        <span style="font-weight: bold;">Mazeret:</span>
        <span id="mazeretMetni" style="font-weight: normal;"></span>
      </th>
    </tr>
  </thead>
</table>


<p style="text-align: right; margin-top: 10px;">
  SaygÄ±larÄ±mla,
</p>

<p id="epostaNotu" style="
        text-align: center;
        font-size: 12px;
        margin-top: 50px;
        color: rgba(0, 0, 0, 0.3);
        font-style: italic;
      "></p>




   <div class="left-text" id="ogrenciBilgileri"></div>
     
     
   <p style="margin-top: 30px; text-align: left;">Eklemek / Silmek  istediÄŸiniz dersin karÅŸÄ±sÄ±na  ( X ) ile iÅŸaretleyiniz.		
</p>

 <table id="dersTablosu"; style="border-collapse: collapse; width: 100%;">
 <thead>

    <!-- 1. SatÄ±r: DERSÄ°N baÅŸlÄ±ÄŸÄ± -->
    <tr>
 <th rowspan="2" style="width: 350px;">DERSÄ°N ADI</th>

      <th colspan="5" 
          style="border-top: 1px solid black;
                 border-left: 1px solid black;
                 border-right: 1px solid black;
                 border-bottom: 1px solid black;
                 padding: 8px;
                 text-align: center;
                 font-weight: bold;">
        DERSÄ°N
      </th>
    </tr>

    <!-- 2. SatÄ±r: BaÅŸlÄ±k hÃ¼creleri -->
    <tr>
      <th style="border-top: 1px solid black;
                 border-left: 1px solid black;
                 border-right: 1px solid black;
                 border-bottom: 1px solid black;
                 padding: 8px;
                 text-align: center;
                 font-size: 8pt;">
        KREDÄ°SÄ°
      </th>
      <th style="border-top: 1px solid black;
                 border-left: 1px solid black;
                 border-right: 1px solid black;
                 border-bottom: 1px solid black;
                 padding: 8px;
                 text-align: center;
                 font-size: 8pt;">
        KODU
      </th>
      <th style="border-top: 1px solid black;
                 border-left: 1px solid black;
                 border-right: 1px solid black;
                 border-bottom: 1px solid black;
                 padding: 8px;
                 text-align: center;
                 font-size: 8pt;">
        GRUBU
      </th>
      <th style="border-top: 1px solid black;
                 border-left: 1px solid black;
                 border-right: 1px solid black;
                 border-bottom: 1px solid black;
                 padding: 8px;
                 text-align: center;
                 font-size: 8pt;">
        EKLENECEK
      </th>
      <th style="border-top: 1px solid black;
                 border-left: 1px solid black;
                 border-right: 1px solid black;
                 border-bottom: 1px solid black;
                 padding: 8px;
                 text-align: center;
                 font-size: 8pt;">
        SÄ°LÄ°NECEK
      </th>
    </tr>
 </thead>
 <tbody></tbody>

  </table>


       <br> 
<strong>Bir YarÄ±yÄ±lda alÄ±nan toplam kredi:</strong> <span id="krediBilgisi"></span></p>

<br><br><br>
Ã–ÄŸrencinin yukarÄ±da almak istediÄŸini beyan ettiÄŸi dersler tarafÄ±mdan kontrol edilmiÅŸ olup, Ã§akÄ±ÅŸmasÄ±<br>
bulunmadÄ±ÄŸÄ±, kredi ve iÃ§erik itibariyle uygun olduÄŸu,  bir yarÄ±yÄ±lda alÄ±nmasÄ± gereken maksimum kredi<br>
sÄ±nÄ±rÄ±nÄ± aÅŸmadÄ±ÄŸÄ± tespit edilmiÅŸtir.
<br><br>
  
<div style="display: flex; justify-content: space-between; margin-top: 40px;">
  <p><strong>DANIÅMANIN ADI SOYADI Ä°MZASI</strong> </p>
  <p><strong>BÃ–LÃœM BAÅKANI</strong> </p>
</div>



 <p style="text-align: right;" id="tarihYeri"></p>
<p style="text-align: right;" id="imzaAlani">Ä°mza: _________</p>



    <div class="download-button" id="downloadBtnDiv">
      <button id="downloadBtn">ğŸ“¥ PDF Olarak Ä°ndir</button>
    </div>
  </div>

  <!-- jsPDF ve html2canvas kÃ¼tÃ¼phaneleri -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
   function formatDersAdi(dersAdi) {
  if (!dersAdi) return "";
  
  const turkishToLower = (str) =>
    str.replace(/Ä°/g, "i").replace(/I/g, "Ä±")
       .replace(/Å/g, "ÅŸ").replace(/Ä/g, "ÄŸ")
       .replace(/Ãœ/g, "Ã¼").replace(/Ã–/g, "Ã¶")
       .replace(/Ã‡/g, "Ã§").toLowerCase();

  const turkishCapitalize = (str) =>
    str.charAt(0).toLocaleUpperCase("tr-TR") + turkishToLower(str.slice(1));

  return dersAdi
    .split(" ")
    .map(kelime => turkishCapitalize(kelime))
    .join(" ");
}


function formatDersKodu(kod) {
  if (!kod) return "";
  const firstThree = kod.slice(0, 3).toUpperCase();
  const rest = kod.slice(3).toLowerCase();
  return firstThree + rest;
}


    function dersEkle() {
      const container = document.getElementById("dersListesi");
      const div = document.createElement("div");
      div.className = "ders-item";
      div.innerHTML = `
        <label>Dersin Kodu:</label>
        <input type="text" name="derskod" required />
        <label>Dersin AdÄ±:</label>
        <input type="text" name="dersad" required />
        <label>Dersin Grubu:</label>
        <input type="text" name="dersgrup" required />
        <label>Dersin Kredisi:</label>
        <input type="text" name="derskredi" required />
        

 
<label>Ä°ÅŸlem TÃ¼rÃ¼:</label>
<select name="dersislem">
  <option value="">-- SeÃ§iniz --</option>
  <option value="ekle">Ekle</option>
  <option value="sil">Sil</option>
</select>



      `;
      container.appendChild(div);
    }

    window.onload = () => dersEkle();

    document.getElementById("dilekceForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const ad = document.getElementById("ad").value;
      const soyad = document.getElementById("soyad").value;
      const numara = document.getElementById("numara").value;
      
      const telefon = document.getElementById("telefon").value;
      const bolum = document.getElementById("bolumSelect").value;
      const mazeret = document.getElementById("mazeret").value;
      const adSoyad = `${ad}_${soyad}`.replace(/\s+/g, "_");
      const krediT = document.getElementById("krediT").value;


      window.adSoyad = adSoyad;

const emailUser = document.getElementById("emailUser").value.trim();
const email = `${emailUser}@std.yildiz.edu.tr`;




      const today = new Date();
      const formattedDate = today.toLocaleDateString("tr-TR");
document.getElementById("ustTarihYazisi").innerText = `Tarih: ${formattedDate}`;


      const bilgiler = `<strong>Ad Soyad:</strong> ${ad} ${soyad}<br>
<strong>Ã–ÄŸrenci No:</strong> ${numara}<br>
<strong>E-posta:</strong> ${email}<br>
<strong>Telefon:</strong> ${telefon}<br><div style="margin-bottom:2cm;"></div>`;
     
      document.getElementById("bolumYazisi").innerText = bolum;
      document.getElementById("tarihYeri").innerText = `Tarih: ${formattedDate}`;
      document.getElementById("mazeretMetni").innerText = mazeret;
      document.getElementById("numaraYazisi").innerText = numara;
document.getElementById("ustTarihYazisi").innerText = `Tarih: ${formattedDate}`;
document.getElementById("adSoyadYazisi").innerHTML = `<strong>AdÄ±-SoyadÄ±:</strong> ${ad} ${soyad}`;
document.getElementById("telefonYazisi").innerHTML = `<strong>GSM No:</strong> ${telefon}`;
document.getElementById("emailYazisi").innerHTML = `<strong>E-posta:</strong> ${email}`;
document.getElementById("numaraYazisi").innerHTML = `<strong>Ã–ÄŸrenci No:</strong> ${numara}`;

document.getElementById("epostaNotu").innerText = `Bu belge ${email} adresinden bÃ¶lÃ¼me iletilmiÅŸtir.`;
 document.getElementById("krediBilgisi").innerText = krediT;

      const tbody = document.querySelector("#dersTablosu tbody");
      tbody.innerHTML = "";

     const dersler = document.querySelectorAll(".ders-item");
dersler.forEach((ders, index) => {
  const total = dersler.length;
  const isFirst = index === 0;
  const isLast = index === total - 1;

  const kodRaw = ders.querySelector("input[name='derskod']").value;
  const kod = formatDersKodu(kodRaw);
  const islem = ders.querySelector("select[name='dersislem']").value;
  const eklenecek = islem === "ekle" ? "X" : "";
  const silinecek = islem === "sil" ? "X" : "";


 


  const ad = formatDersAdi(ders.querySelector("input[name='dersad']").value);
  const grup = ders.querySelector("input[name='dersgrup']").value;
  const kredi = ders.querySelector("input[name='derskredi']").value;

  // SatÄ±ra Ã¶zel border yapÄ±sÄ±
  const topBorder = "1px solid black";
  const bottomBorder = "1px solid black";

  const row = document.createElement("tr");
  row.innerHTML = `
    <td style="border-left: 1px solid black; border-top: ${topBorder}; border-bottom: ${bottomBorder}; border-right: 1px solid black;">${ad}</td>
    <td style="border: 1px solid black; border-top: ${topBorder}; border-bottom: ${bottomBorder};">${kredi}</td>
    <td style="border: 1px solid black; border-top: ${topBorder}; border-bottom: ${bottomBorder};">${kod}</td>
    <td style="border: 1px solid black; border-top: ${topBorder}; border-bottom: ${bottomBorder};">${grup}</td>
    <td style="border: 1px solid black; border-top: ${topBorder}; border-bottom: ${bottomBorder};">${eklenecek}</td>
    <td style="border-right: 1px solid black; border-top: ${topBorder}; border-bottom: ${bottomBorder}; border-left: 1px solid black;">${silinecek}</td>
  `;
  tbody.appendChild(row);
});



      document.getElementById("dilekceOutput").style.display = "block";
      document.getElementById("downloadBtnDiv").style.display = "block";
    });

    document.getElementById("downloadBtn").addEventListener("click", function () {
  const img = document.querySelector(".logo-image");
  const downloadBtnDiv = document.getElementById("downloadBtnDiv");

  // Butonu gizle
  downloadBtnDiv.style.visibility = "hidden";

  if (!img.complete) {
    img.onload = () => startPdf();
    img.onerror = () => {
      alert("Logo yÃ¼klenemedi!");
      startPdf();
    };
  } else {
    startPdf();
  }

  function startPdf() {
    const element = document.getElementById("dilekceOutput");

    html2canvas(element, {
      scale: 3,
      useCORS: true,
      logging: false
    }).then(canvas => {
      const imgData = canvas.toDataURL("image/png");

      const pdfWidth = 210;
      const pdfHeight = 297;
      const canvasWidth = canvas.width;
      const canvasHeight = canvas.height;
      const pxPerMm = canvasWidth / pdfWidth;
      const imgHeightInPdf = canvasHeight / pxPerMm;

      const pdf = new window.jspdf.jsPDF({
        unit: "mm",
        format: "a4",
        orientation: "portrait"
      });

      let renderHeight = imgHeightInPdf;
      let renderWidth = pdfWidth;

      if (imgHeightInPdf > pdfHeight) {
        const scale = pdfHeight / imgHeightInPdf;
        renderHeight = pdfHeight;
        renderWidth = pdfWidth * scale;
      }

      pdf.addImage(imgData, "PNG", 0, 0, renderWidth, renderHeight);

pdf.setFont("helvetica", "italic"); // italik font
pdf.setFontSize(8);
pdf.setTextColor(150); // silik gri
pdf.text("Form No: FR-0531; Revizyon Tarihi: 14.01.2014; Revizyon No:02", 10, 290);

      pdf.save(`${window.adSoyad || "dilekce"}.pdf`);

      // Butonu tekrar gÃ¶ster
      downloadBtnDiv.style.visibility = "visible";
    }).catch(e => {
      alert("PDF oluÅŸturulurken hata oluÅŸtu: " + e.message);
      downloadBtnDiv.style.visibility = "visible";
    });
  }
});

  </script>
</body>
</html>

